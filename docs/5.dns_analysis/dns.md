## DNS Traffic Analysis
  - DNS can run over UDP or TCP (most commonly for UDP)
  - Default port for DNS is port 53
  - RFC 1035, Domain Names - Implementation and Specification, limits DNS over UDP packet payload to 512 bytes.
  - If a response requires more than 512 bytes, a truncation flag is set in the response. This triggers the resolver to send the DNS query again using TCP, which allows for a larger packet size.
  - There are times when you can observe an ICMP response i.e. ICMP type3 : The ICMP destination unreachable message is generated by a router to inform the source host that the destination unicast address is unreachable.
  - A primary DNS server has the "master copy" of a zone, and secondary DNS servers keep copies of the zone for redundancy.
  - When changes are made to zone data on the primary DNS server, these changes must be distributed to the secondary DNS servers for the zone. This is done through Zone transfers (TCP port 53)


### DNS Packet Structure
**Transaction ID**
 - The Transaction ID field associates DNS queries with responses.
 - You can filter on this field and value (for example, dns.id==0x05b5) to view all associated DNS queries/responses.
 - Also viewable in the info column.

 **Flags**
 Flags consists of many fields that define query characteristics.

_Query/Response_
The Query/Response bit indicates whether the packet is a query (0) or a response (1). You can build a Wireshark filter to display DNS queries (dns.flags.response==0) or responses (dns.flags.response==1).

_Opcode_
The Opcode field specifies the type of query. Most commonly, this field contains 0000 for standard queries and the field is left at 0000 in the responses.

_Authoritative Answer_
Used in responses, the Authoritative Answer field indicates that the response is from an authoritative server for the domain name.

_Truncation_
The Truncation field indicates the DNS response was truncated because of the length. If a client sees a truncated DNS response, it should retry the query over TCP. It is not very common to see TCP based queries/responses.

_Recursion Desired_
Recursion can be defined in DNS queries to indicate whether the server may use recursive query processes. Recursion allows a DNS server to ask another server for an answer on the client’s behalf. If the local name server has the answer, it will reply directly. If it does not have the answer, it will begin the lookup process on behalf of the client.

_Recursion Available_
Defined in responses, this setting indicates whether recursion is available at the DNS server.

_Reply/Response Code_
The Reply code field indicates whether an error condition exists in the response. See below possible Reply code values.   
  - Code 0: No error condition.   
  - Code 1: Format error—query could not be interpreted.    
  - Code 2: Server failure—server could not process query due to a problem with the name server.
  - Code 3: Name error—domain name does not exist.  
  - Code 4: Not implemented.    
  - Code 5: Refused—name server refuses to perform function due to policy.    

**Question Count**
This field indicates the number of questions in the Question section. Typically you will see only one question per query packet.  

**Answer Resource Record (RR) Count**
This field indicates the number of answers in the Answer RRs section. If a response contains CNAME information you will likely see a count of two in the Answer RR Count area—one for the CNAME and another for the IP address of the CNAME record.

**Authority RRs Count**
This field indicates the number of answers in the Authority RRs section. These responses come from servers that are closer to the target name in the naming hierarchy.

**Additional RRs Count**
This field indicates the number of answers in the Additional RRs section. In this section you may find A records for servers in the Authority RR section.

**Queries/Answers**
This variable-length field defines the name that is being resolved and the type of information desired.

_Name_
This field includes the name being resolved.

_Type_
This field indicates the type of query.
  - Type A: Host address
  - Type NS: Authoritative name server
  - Type CNAME: Canonical name for an alias Type SOA: Start of Zone Authority
  - Type PTR: Pointer record
  - Type HINFO: Host information
  - Type MX: Mail exchange
  - Type AAAA: IPv6 address

_Resource Record Time to Live (TTL) Value_
This field is contained in the Answer section of DNS responses and indicates how long the receiver can maintain the DNS information in cache. Each answer in DNS will contain a TTL value for that DNS information.

###Common display filters to help DNS Analysis
```sh
dns.flags.response==0
#DNS queries

dns.flags.response==1
#DNs responses

dns.flags.rcode != 0
#DNS response contains an error

dns.count.answers > 5
#DNS response contains more than 5 responses

dns.qry.name=="www.abc.com"
#DNS query is for www.abc.com

dns contains "abc"
#DNS query or response contains the string "abc"

dns.qry.type==0x0001
#DNS query is for a host name

dns.qry.type==0x000c
#DNS query is a domain name pointer query (inverse query)

dns.resp.type==0x0005
#DNS response contains a CNAME value (canonical name)

dns.resp.type==0x0006
#DNS response contains SOA (Start of Authority) information

dns.flags.recdesired==1
#DNS query with recursion desired

dns.flags.recavail==1
#DNS response stating recursion available
```
